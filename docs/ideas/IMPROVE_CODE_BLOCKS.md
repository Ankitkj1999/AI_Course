# Plan to Improve Code Block Rendering

This document outlines the plan to improve the rendering of code blocks in the AiCourse application. The goal is to move from the current implementation to a more robust and visually appealing solution, inspired by the `developer-roadmap` project.

## 1. Replace `react-syntax-highlighter` with `shiki`

The current syntax highlighting is done by `react-syntax-highlighter`. We will replace this with `shiki`.

**Reasoning:**
- `shiki` uses the same text-to-HTML engine as VS Code, providing higher-fidelity syntax highlighting.
- It supports a wide range of languages and themes out of the box.
- It's highly customizable and allows for advanced features like line highlighting and diffs through transformers.

**Tasks:**
- Install `shiki` and `@shikijs/transformers`.
- Remove `react-syntax-highlighter`.

## 2. Create Dedicated Code Block Components

We will create a set of dedicated React components to structure the display of code blocks. This is a more modular and maintainable approach than having all the logic inside the `StyledText` component.

**Components to create:**
- `CodeBlock`: The main wrapper component.
- `CodeBlockHeader`: A header for the code block that can display the language name and a copy button.
- `CodeBlockContent`: The component that will contain the syntax-highlighted code generated by `shiki`.

**Tasks:**
- Create the new component files.
- Implement the logic for these components, including the copy-to-clipboard functionality.

## 3. Integrate `shiki` and the New Components

The new `CodeBlock` component will be integrated into the `StyledText` component's `ReactMarkdown` renderer.

**Tasks:**
- In `StyledText.tsx`, modify the `components` prop passed to `ReactMarkdown`.
- The `code` component override will now use the new `CodeBlock` component.
- The `code` override will extract the language from the code fence and pass it as a prop to `CodeBlock`.
- The `CodeBlockContent` component will use `shiki` to convert the code string to highlighted HTML.

## 4. Style the Code Block Components

We will add CSS to style the new components to be visually appealing and consistent with the rest of the application. The styling will be inspired by the `developer-roadmap` example.

**Styling goals:**
- A clear header section for the code block.
- A copy button that is easy to see and use.
- A well-formatted and readable code area.
- A dark theme for the code blocks that matches the `vscDarkPlus` theme used by `shiki`.

**Tasks:**
- Add CSS rules for the new components. This might involve creating a new CSS file or adding to an existing one.

## 5. Default Language and Error Handling

We will consider what to do when a language is not specified in a Markdown code fence.

**Tasks:**
- Implement a fallback to a default language (e.g., `plaintext`) if no language is provided.
- Ensure that the component renders gracefully if there is an error during highlighting.
